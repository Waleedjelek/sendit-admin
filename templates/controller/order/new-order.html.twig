{% extends 'base.html.twig' %}
{% block title %}New Orders
{% endblock %}
{% block body %}
	<div class="row">
		<div class="col-12">
			<div class="main-order-pg-btn-flex">
				<div class="accept-order-img">
					<img class="img-set" src="{{ asset('images/OrderCompleted.png') }}" alt="Logo" style="width: 45px;height: 43px; margin-top: 6px;">
					<h2 class="title-heading">All New Orders</h2>
				</div>
				{% include 'controller/new_order_quote/index.html.twig' with {'newOrders': newOrders, 'newQuotes': newQuotes} %}
			</div>
		</div>
	</div>
	<div class="row">
		<div class="col-12 bgcolor-table">
			<div style="border-radius:15px !important" class="card">
				<div class="card-body" style="padding-top: 5px;">
					<div class="row align-items-center justify-content-between">
						<div class="input-container">
							<input id="searchField" class="search-feild-text" type="text" placeholder="Search">
							<i class="fa fa-search"></i>
						</div>
						<div class="mt-2" id="entriesDropdownContainer" style="margin-right: 15px;"></div>
					</div>
					<table class="table table-bordered table-hover dataTable2" id="ordersTableList">
						<thead>
							<tr>
								<th class="text-center align-middle">Order ID</th>
								<th class="text-center align-middle">Courier Company</th>
								<th class="text-center align-middle">Country</th>
								<th class="text-center align-middle">Total (AED)</th>
								<th class="text-center align-middle">Status</th>
								<th class="text-center align-middle">Payment Status</th>
								<th class="text-center align-middle">Order Type</th>
								<th class="text-center align-middle">Coupon Code</th>
								<th class="text-center align-middle">Date</th>
								<th class="text-center align-middle">Details</th>
							</tr>
						</thead>
					</table>
				</div>
			</div>
		</div>
	</div>
{% endblock %}
{% block inlineCss %}
	<style>
		#entriesDropdownContainer label {
			display: flex;
			align-items: center;
			font-size: 14px;
			font-weight: 500;
		}
		#entriesDropdownContainer select {
			margin: 0 5px;
			padding: 3px 8px;
			border-radius: 5px;
			border: 1px solid #ccc;
			background: white;
			cursor: pointer;
		}
	</style>
{% endblock %}
{% block inlineJs %}
	 <script>
	        $(document).ready(function () {
	            let ordersTable;
	    
	            ordersTable = $('#ordersTableList').DataTable({
	                processing: true,
	                serverSide: true,
	                autoWidth: false,
	                dom: '<"row"<"col-md-6"f><"col-md-6"l>>rt<"row"<"col-md-6"i><"col-md-6"p>>',
	                columnDefs: [
	                    { targets: [0], width: '30%' },
	                    { targets: [1], width: '15%' },
	                    { targets: [8], width: '25%' },
	                    { targets: [2, 3, 4, 5, 6, 7], width: '5%' },
	                ],
	                ajax: {
	                    url: "{{ path('app_new_order_index') }}",
	                    type: 'POST',
	                    data: function (d) {
	                        // Check URL parameters first
	                        const urlParams = new URLSearchParams(window.location.search);
						
	                        // Pass show_all parameter from URL
	                        const urlShowAll = urlParams.get('show_all');
	                        if (urlShowAll !== null) {
	                            d.show_all = urlShowAll;
	                        }
						
	                        // Always show Ready orders only (no status filter needed)
	                        d.filter_status = '';
						
	                        // No date filtering (show all Ready orders)
	                        d.filter_start_date = '';
	                        d.filter_end_date = '';
						
	                        d.search = { value: $('#searchField').val() };
	                    }
	                },
	                columns: [
	                    { data: "orderId" },
	                    { data: "company" },
	                    {
	                        data: null,
	                        render: function (data) {
	                            return `${data.from} <i class="fas fa-arrow-right"></i> ${data.to}`;
	                        }
	                    },
	                    { data: "price" },
	                    { data: "status" },
	                    { data: "paymentStatus" },
	                    { data: "type" },
	                    { data: "coupon" },
	                    { data: "createdDate" },
	                    {
	                        data: "action",
	                        render: function (data) {
	                            return `<a href="${data.details}" class="btn btn-default"><i class="fas fa-info-circle"></i> Details</a>`;
	                        }
	                    }
	                ]
	            });
	            
	            // Move "Show Entries" dropdown next to Add Company button
	                let entriesDropdown = $('#ordersTableList_length').detach();
	                $('#entriesDropdownContainer').append(entriesDropdown);
	                    // Trigger search on input change
	                   
	                     $('#searchField').on('input', function (){
	                ordersTable.ajax.reload();
	            });
	        });
	    </script>
{% endblock %}
