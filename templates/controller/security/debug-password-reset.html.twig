{% extends 'empty-base.html.twig' %}
{% block title %}Send Test Email{% endblock %}
{% block bodyClass %}debug-page{% endblock %}
{% block body %}
<div class="container-fluid" style="padding: 20px; max-width: 800px; margin: 0 auto;">
    <div class="card">
        <div class="card-header">
            <h1 style="margin: 0;">Send Test Email</h1>
            <p style="margin: 5px 0 0 0; color: #666;">Test your email configuration by sending a test email</p>
        </div>
        <div class="card-body">
            <!-- Success/Error Messages -->
            {% if emailResult is defined and emailResult.message %}
                {% if emailResult.success %}
                    <div class="alert alert-success" style="margin-bottom: 20px;">
                        <h4 style="margin-top: 0;"><strong>âœ“ Success!</strong></h4>
                        <p style="margin-bottom: 0; font-size: 16px;">{{ emailResult.message }}</p>
                    </div>
                {% else %}
                    <div class="alert alert-danger" style="margin-bottom: 20px;">
                        <h4 style="margin-top: 0;"><strong>âœ— Error!</strong></h4>
                        <p style="margin-bottom: 10px; font-size: 16px;"><strong>{{ emailResult.message }}</strong></p>
                        {% if emailResult.error_details %}
                            <div style="background-color: #fff; padding: 15px; border-radius: 4px; margin-top: 10px;">
                                <h5 style="margin-top: 0;">Error Details:</h5>
                                <table class="table table-bordered" style="margin-bottom: 0;">
                                    <tr>
                                        <th style="width: 30%;">Error Message</th>
                                        <td><code>{{ emailResult.error_details.message }}</code></td>
                                    </tr>
                                    {% if emailResult.exception is defined and emailResult.exception %}
                                    <tr>
                                        <th>Exception Type</th>
                                        <td><code>{{ emailResult.exception }}</code></td>
                                    </tr>
                                    {% endif %}
                                    {% if emailResult.error_details.code is defined and emailResult.error_details.code %}
                                    <tr>
                                        <th>Error Code</th>
                                        <td><code>{{ emailResult.error_details.code }}</code></td>
                                    </tr>
                                    {% endif %}
                                    {% if emailResult.error_details.file is defined and emailResult.error_details.file %}
                                    <tr>
                                        <th>File</th>
                                        <td><code>{{ emailResult.error_details.file }}</code></td>
                                    </tr>
                                    {% endif %}
                                    {% if emailResult.error_details.line is defined and emailResult.error_details.line %}
                                    <tr>
                                        <th>Line</th>
                                        <td><code>{{ emailResult.error_details.line }}</code></td>
                                    </tr>
                                    {% endif %}
                                    {% if emailResult.error_details.trace is defined and emailResult.error_details.trace %}
                                    <tr>
                                        <th>Stack Trace</th>
                                        <td>
                                            <pre style="background: #f4f4f4; padding: 10px; border-radius: 4px; overflow-x: auto; max-height: 300px; overflow-y: auto; font-size: 12px;">{{ emailResult.error_details.trace }}</pre>
                                        </td>
                                    </tr>
                                    {% endif %}
                                    {% if emailResult.error_details.configuration is defined %}
                                    <tr>
                                        <th>Email Configuration</th>
                                        <td>
                                            <table class="table table-sm" style="margin-bottom: 0; background-color: #f8f9fa;">
                                                {% for key, value in emailResult.error_details.configuration %}
                                                <tr>
                                                    <td style="width: 40%;"><strong>{{ key }}</strong></td>
                                                    <td><code>{{ value }}</code></td>
                                                </tr>
                                                {% endfor %}
                                            </table>
                                        </td>
                                    </tr>
                                    {% endif %}
                                    {% if emailResult.error_details.troubleshooting is defined %}
                                    <tr>
                                        <th>Troubleshooting Steps</th>
                                        <td>
                                            <ul style="margin-bottom: 0;">
                                                {% for step, description in emailResult.error_details.troubleshooting %}
                                                <li><strong>{{ step }}:</strong> {{ description }}</li>
                                                {% endfor %}
                                            </ul>
                                        </td>
                                    </tr>
                                    {% endif %}
                                </table>
                            </div>
                        {% endif %}
                    </div>
                {% endif %}
            {% endif %}

            <!-- Email Form -->
            <div class="card mb-4" style="background-color: #f8f9fa;">
                <div class="card-body">
                    <h3>Send Test Email</h3>
                    <form method="get" action="{{ path('app_debug_password_reset') }}">
                        <div class="form-group">
                            <label for="email">Email Address:</label>
                            <input type="email" id="email" name="email" class="form-control" value="{{ email }}" placeholder="Enter email address" style="text-transform: lowercase;" required>
                        </div>
                        <button type="submit" name="send_email" value="1" class="btn btn-success">
                            ðŸ“§ Send Test Email
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    .debug-page {
        background-color: #f4f6f9;
    }
    .card {
        box-shadow: 0 0 1px rgba(0,0,0,.125), 0 1px 3px rgba(0,0,0,.2);
        margin-bottom: 1rem;
    }
    code {
        background-color: #f4f4f4;
        padding: 2px 6px;
        border-radius: 3px;
        font-size: 0.9em;
    }
    pre {
        max-height: 400px;
        overflow-y: auto;
    }
    .badge {
        padding: 0.25em 0.6em;
        font-weight: 700;
        font-size: 0.75em;
    }
    .badge-success {
        background-color: #28a745;
        color: white;
    }
    .badge-danger {
        background-color: #dc3545;
        color: white;
    }
    .badge-warning {
        background-color: #ffc107;
        color: black;
    }
    .badge-info {
        background-color: #17a2b8;
        color: white;
    }
</style>
{% endblock %}
